---
title: "P8105 Homework 3"
author: "Thirsten Stockton"
date: "2022-10-15"
output: github_document
---
```{r setup, include=FALSE}
library(p8105.datasets)
library(tidyverse)

```

# Problem 1

***Data Exploration***

Importing Data
```{r}

data("instacart")

instacart = 
  instacart %>% 
  as_tibble(instacart)

```

Finding number of users
```{r}

instacart %>%
  select(user_id) %>%
    distinct %>%
      count
```

Average days in between orders (capped at 30)
```{r}

mean(instacart$days_since_prior_order, na.rm =TRUE)

```

Finding peak order hours
```{r}
max_df <-
instacart %>%
  group_by(order_hour_of_day) %>%
  summarize(
     n = n_distinct(order_id)
    ) 

max_df %>%
    arrange(desc(n))

```



This dataset has 15 columns and 1,384,617 rows with each row representing a product from an order. Key variables include information on the customer identifier, order identifier and product name. Additionally, there is information on the day of the week on which the order was placed, the hour in which it was placed and number of days since the previous order. To provide even more details, this dataset also includes the department name and aisle in which the product would be found. In total, there were a total of 131,209 unique users in this dataset. The average day in between orders was ~17 days and on average, orders peaked around 3pm.


***How many aisles are there, and which aisles are the most items ordered from?***

```{r}
instacart %>% 
  count(aisle) %>% 
   arrange(desc(n))
```
There are 134 aisle and the most commonly ordered from aisles are the fresh fruits, fresh vegetables, and packed fruit and vegetables aisles.

***Make a plot that shows the number of items ordered in each aisle, limiting this to aisles with more than 10000 items ordered. Arrange aisles sensibly, and organize your plot so others can read it.***

```{r}

instacart %>% 
  count(aisle) %>% 
  filter(n > 10000) %>% 
  mutate(aisle = fct_reorder(aisle, n)) %>% 
  ggplot(aes(x = aisle, y = n)) + 
  geom_point() + 
  labs(title = "Number of items ordered in each aisle") +
  theme(axis.text.x = element_text(angle = 60, hjust = 1))

```

***Make a table showing the three most popular items in each of the aisles “baking ingredients”, “dog food care”, and “packaged vegetables fruits”. Include the number of times each item is ordered in your table.***

```{r}
instacart %>% 
  filter(aisle %in% c("baking ingredients", "dog food care", "packaged vegetables fruits")) %>%
    group_by(aisle) %>% 
      count(product_name) %>% 
        mutate(rank = min_rank(desc(n))) %>% 
        filter(rank < 4) %>% 
          arrange(desc(n)) %>%
            knitr::kable()
```

***Make a table showing the mean hour of the day at which Pink Lady Apples and Coffee Ice Cream are ordered on each day of the week; format this table for human readers (i.e. produce a 2 x 7 table).***

```{r, message=FALSE}
instacart %>%
  filter(product_name %in% c("Pink Lady Apples", "Coffee Ice Cream")) %>%
    group_by(product_name, order_dow) %>%
      summarize(mean_hour = mean(order_hour_of_day)) %>%
        spread(key = order_dow, value = mean_hour) %>%
           knitr::kable(digits = 2)
```

#Problem 2

***Loading data set***

```{r}

accel <-
read.csv("./accel_data.csv") %>%
 pivot_longer(
          activity.1:activity.1440,
          names_to = "Minute",
          names_prefix = "min_",
          values_to = "Activity Count" ) 
 
 skimr::skim(accel)
 
```


    